@{
    ViewData["Title"] = "Chọn vị trí cửa hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>🗺️ Bản đồ chọn vị trí cửa hàng </h2>

<button onclick="getCurrentLocation()">📍 Lấy vị trí hiện tại</button>
<br />
<br />

<input type="text" id="storeLocation" placeholder="Nhập địa chỉ cửa hàng..." style="width: 300px;" />
<button onclick="geocodeAddress()">🔍 Tìm</button>

<style>
    #map {
        height: 500px;
        width: 100%;
        border: 2px solid #ccc;
        border-radius: 8px;
    }
    button {
        margin-right: 10px;
        padding: 8px 16px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    button:hover {
        background-color: #0056b3;
        }
</style>
<div id="map" style="height: 500px; margin-top: 20px;"></div>


<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDUqHa5xcgyDBd9xSgf71sQpTAMXYBiPtQ&callback=initMap&libraries=places"
        async defer></script>

<script>
    let map;
    let marker;
    let geocoder;

    function initMap() {
        const defaultLocation = { lat: 10.762622, lng: 106.660172 }; // TP.HCM

        const vintageStyle = [
            { elementType: "geometry", stylers: [{ color: "#ebe3cd" }] },
            { elementType: "labels.text.fill", stylers: [{ color: "#523735" }] },
            { elementType: "labels.text.stroke", stylers: [{ color: "#f5f1e6" }] },
            {
                featureType: "administrative",
                elementType: "geometry.stroke",
                stylers: [{ color: "#c9b2a6" }]
            },
            {
                featureType: "poi",
                elementType: "geometry",
                stylers: [{ color: "#dfd2ae" }]
            },
            {
                featureType: "road",
                elementType: "geometry",
                stylers: [{ color: "#f5f1e6" }]
            },
            {
                featureType: "water",
                elementType: "geometry.fill",
                stylers: [{ color: "#b9d3c2" }]
            }
        ];

        map = new google.maps.Map(document.getElementById("map"), {
            zoom: 13,
            center: defaultLocation,
            styles: vintageStyle,
        });

        geocoder = new google.maps.Geocoder();

        marker = new google.maps.Marker({
            position: defaultLocation,
            map: map,
            draggable: true,
            title: "📌 Vị trí cửa hàng",
        });

        marker.addListener("dragend", function () {
            const pos = marker.getPosition();
            alert("📌 Vị trí đã chọn:\nLat: " + pos.lat() + "\nLng: " + pos.lng());
        });
    }

    function getCurrentLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function (position) {
                const pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude,
                };
                map.setCenter(pos);
                marker.setPosition(pos);
                alert("📍 Vị trí hiện tại:\nLat: " + pos.lat + "\nLng: " + pos.lng);
            }, function () {
                alert("❌ Không thể lấy vị trí hiện tại.");
            });
        } else {
            alert("⚠️ Trình duyệt không hỗ trợ Geolocation.");
        }
    }

    function geocodeAddress() {
        const address = document.getElementById("storeLocation").value;
        geocoder.geocode({ address: address }, function (results, status) {
            if (status === "OK") {
                map.setCenter(results[0].geometry.location);
                marker.setPosition(results[0].geometry.location);
            } else {
                alert("❌ Không tìm thấy địa chỉ: " + status);
            }
        });
    }
</script>
